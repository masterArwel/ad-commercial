---
alwaysApply: true
---

# 代码工程规范
**强制承诺**：在编码实施前，我会认真阅读下面的工程规范，掌握项目的层次架构、编写规范及各个模块的逻辑组织，以确保代码编写符合项目规范。

## 1. 项目介绍
- 这是一个基于 React.js 18.x 构建的广告投放管理 Web 前端项目，名为 Ad Commercial Platform(广告投放管理平台)
- 项目提供广告投放、人群管理、DMP数据管理、数据分析、系统工具等广告投放和账户运营功能
- 技术栈：React 18 + Ant Design + TypeScript + TanStack Router + Vite + Zustand(预留) + Less
- 主要依赖：Ant Design（UI组件库）、TanStack Router（路由管理）、Zustand（状态管理，预留）、Less（样式预处理器）

## 2. 项目结构
```
adcommercial/                         # 项目根目录
├── src/                              # 业务源码目录
│   ├── components/                   # 业务公共组件
│   │   ├── AntdDemo.tsx             # Ant Design 演示组件
│   │   ├── AntdProvider.tsx         # Ant Design 配置提供者
│   │   ├── ApiExample.tsx           # API 调用示例组件
│   │   ├── BreadcrumbNav.tsx        # 面包屑导航组件
│   │   ├── Loading.tsx              # 加载组件
│   │   └── PageTemplate.tsx         # 页面模板组件
│   ├── pages/                       # 页面视图层
│   │   ├── dashboard/               # 仪表盘模块
│   │   │   ├── dashboard.tsx        # 仪表盘主页面
│   │   │   ├── index.tsx            # 仪表盘概览页面
│   │   │   └── index.ts             # 导出文件
│   │   ├── advertising/             # 广告投放模块
│   │   │   ├── advertisers.tsx      # 广告主管理
│   │   │   ├── plan.tsx             # 广告计划
│   │   │   ├── campaign.tsx         # 广告活动
│   │   │   └── index.ts             # 导出文件
│   │   ├── crowd/                   # 人群管理模块
│   │   │   └── manage.tsx           # 人群管理
│   │   ├── dmp/                     # DMP数据管理模块
│   │   │   └── crowd-list.tsx       # 人群列表
│   │   ├── analytics/               # 数据分析模块
│   │   │   └── flow-analysis.tsx    # 流量分析
│   │   └── tools/                   # 工具模块
│   │       └── white-list.tsx       # 白名单管理
│   ├── routes/                      # 路由配置
│   │   ├── __root.tsx               # 根路由
│   │   ├── index.tsx                # 首页路由
│   │   ├── advertising/             # 广告投放路由
│   │   │   ├── index.tsx            # 广告投放概览
│   │   │   ├── advertisers.tsx      # 广告主管理路由
│   │   │   ├── plan.tsx             # 广告计划路由
│   │   │   └── campaign.tsx         # 广告活动路由
│   │   ├── crowd/                   # 人群管理路由
│   │   │   └── manage.tsx           # 人群管理路由
│   │   ├── dmp/                     # DMP数据管理路由
│   │   │   └── crowd-list.tsx       # 人群列表路由
│   │   ├── analytics/               # 数据分析路由
│   │   │   └── flow-analysis.tsx    # 流量分析路由
│   │   └── tools/                   # 工具路由
│   │       └── white-list.tsx       # 白名单管理路由
│   ├── layouts/                     # 布局组件
│   │   └── AppLayout.tsx            # 主应用布局
│   ├── config/                      # 配置文件
│   │   └── menuConfig.ts            # 菜单配置
│   ├── hooks/                       # React Hooks
│   │   └── usePermissions.ts        # 权限管理Hook
│   ├── utils/                       # 工具函数
│   │   ├── iconMap.tsx              # 图标映射工具
│   │   └── request.ts               # 请求工具
│   ├── services/                    # API 服务
│   │   ├── base.ts                  # 基础服务
│   │   └── user.ts                  # 用户服务
│   ├── stores/                      # Zustand 状态管理
│   │   └── index.ts                 # 状态管理入口
│   ├── types/                       # TypeScript类型定义
│   │   ├── antd.d.ts                # Ant Design 类型扩展
│   │   └── tanstack-router.d.ts     # TanStack Router 类型声明
│   ├── routeTree.gen.ts             # TanStack Router 自动生成的路由树
│   ├── main.tsx                     # 应用入口
│   ├── index.css                    # 全局样式
│   └── vite-env.d.ts                # Vite 环境类型声明
├── public/                          # 静态资源目录
├── dist/                            # 构建输出目录
├── .cursor/                         # Cursor 配置目录
│   └── rules/                       # 代码规范配置
├── .tanstack/                       # TanStack Router 缓存目录
├── vite.config.ts                   # Vite构建配置
├── tsconfig.json                    # TypeScript配置
├── tsconfig.node.json               # Node.js TypeScript配置
├── package.json                     # 项目依赖配置
├── package-lock.json                # 依赖锁定文件
├── .gitignore                       # Git忽略文件
├── index.html                       # HTML模板
└── README.md                        # 项目说明文档
```

## 3. 文件命名规范
- **页面文件**：使用 camelCase（如：`dashboard.tsx`、`advertisers.tsx`、`manage.tsx`）
- **组件文件**：使用 PascalCase（如：`AppLayout.tsx`、`BreadcrumbNav.tsx`、`Loading.tsx`）
- **路由文件**：使用 kebab-case 或 camelCase（如：`index.tsx`、`advertisers.tsx`、`flow-analysis.tsx`）
- **服务文件**：使用 camelCase（如：`base.ts`、`user.ts`）
- **工具函数文件**：使用 camelCase（如：`request.ts`、`iconMap.tsx`）
- **配置文件**：使用 camelCase（如：`menuConfig.ts`、`vite.config.ts`）
- **TypeScript文件**：使用 `.ts` 或 `.tsx` 后缀

## 4. 样式开发规范
- 本项目使用 **CSS**、**Less** 和 **Ant Design** 样式系统
- **强制**：统一使用 px 作为像素单位，基于桌面端 Web 应用开发
- **强制**：避免全局样式污染，使用局部作用域的样式类名或 CSS Modules
- **推荐**：使用 Ant Design 组件库的主题定制和样式覆盖机制
- **强制**：当盒子设置了padding后，建议设置 `box-sizing: border-box;` 来防止盒子宽度溢出问题
- **推荐**：复杂样式使用 Less 文件，简单样式可以使用内联样式

## 5. 页面开发规范

### 5.1 路由配置（TanStack Router）
#### 5.1.1 路由定义位置：
- 路由配置：`src/routes/` 目录下的各个 `.tsx` 文件
- 布局组件：`src/layouts/AppLayout.tsx`
- 应用入口：`src/main.tsx`
- 根路由：`src/routes/__root.tsx`

#### 5.1.2 新增页面路由步骤：
```typescript
// 1. 在 src/routes/ 目录下创建对应的路由文件
// 例如：src/routes/advertising/advertisers.tsx
import { createFileRoute } from '@tanstack/react-router';
import { AdvertisersPage } from '@/pages/advertising';

export const Route = createFileRoute('/advertising/advertisers')({
  component: AdvertisersPage,
});

// 2. 在 src/pages/ 目录下创建对应的页面组件
// 例如：src/pages/advertising/advertisers.tsx
export function AdvertisersPage() {
  return <div>广告主管理页面</div>;
}

// 3. 路由会自动注册到 TanStack Router 系统中
```

### 5.2 页面主文件开发规范
- **页面组件模板**：React 页面组件请遵循如下规范：
```typescript
import React, { useState, useEffect } from 'react';
import { Card, Table, Button, Space, Typography } from 'antd';
import type { ColumnsType } from 'antd/es/table';
import { useNavigate } from '@tanstack/react-router';

const { Title } = Typography;

interface DataItem {
  id: string /** 数据ID */;
  name: string /** 名称 */;
  status: number /** 状态 */;
}

export function YourPage() {
  const navigate = useNavigate();
  const [loading, setLoading] = useState(false);
  const [tableData, setTableData] = useState<DataItem[]>([]);

  // 页面初始化
  useEffect(() => {
    fetchData();
  }, []);

  // 数据请求方法
  const fetchData = async () => {
    try {
      setLoading(true);
      // const response = await yourPageApi.getData();
      // setTableData(response.data || []);
    } catch (error) {
      console.error('获取数据失败:', error);
    } finally {
      setLoading(false);
    }
  };

  // 新建操作
  const handleCreate = () => {
    // 新建逻辑
  };

  // 编辑操作
  const handleEdit = (record: DataItem) => {
    // 编辑逻辑
  };

  // 删除操作
  const handleDelete = (record: DataItem) => {
    // 删除逻辑
  };

  // 表格列定义
  const columns: ColumnsType<DataItem> = [
    {
      title: '名称',
      dataIndex: 'name',
      key: 'name',
    },
    {
      title: '状态',
      dataIndex: 'status',
      key: 'status',
    },
    {
      title: '操作',
      key: 'action',
      width: 180,
      render: (_, record) => (
        <Space size="small">
          <Button size="small" type="link" onClick={() => handleEdit(record)}>
            编辑
          </Button>
          <Button size="small" danger type="link" onClick={() => handleDelete(record)}>
            删除
          </Button>
        </Space>
      ),
    },
  ];

  return (
    <div>
      <Card
        title={<Title level={4}>页面标题</Title>}
        extra={
          <Button type="primary" onClick={handleCreate}>
            新建
          </Button>
        }
      >
        <Table
          columns={columns}
          dataSource={tableData}
          loading={loading}
          rowKey="id"
          pagination={{
            total: tableData.length,
            pageSize: 10,
            showSizeChanger: true,
            showQuickJumper: true,
            showTotal: (total) => `共 ${total} 条记录`,
          }}
        />
      </Card>
    </div>
  );
}

export default YourPage;
```

#### 5.2.1 页面开发要求：
- **React版本**：使用 React 18，支持 Hooks 和函数组件
- **状态管理**：组件内部状态使用 useState，全局状态使用 Zustand（预留）
- **基础组件**：基于 Ant Design 组件库
- **网络请求**：使用封装的 request 工具（utils/request.ts），统一错误处理和响应格式
- **路由**：基于 TanStack Router，支持动态路由和类型安全
- **类型定义**：所有接口和组件必须定义 TypeScript 类型
- **按钮样式**：操作按钮统一使用 `type="link"` 样式，避免使用图标

### 5.3 页面样式规范
- **样式文件**：使用 `.css` 或 `.less` 后缀，文件名通常与组件同名
- **样式类名**：建议使用页面模块名作为前缀，避免样式冲突
- **样式组织**：使用 CSS Modules 或内联样式
- **内联样式**：简单样式可以直接使用 style 属性

### 5.4 布局组件使用
- **主布局**：项目使用 AppLayout.tsx 组件，包含固定头部、侧边栏
- **页面容器**：页面内容建议使用 Ant Design 的 Card、Layout 等容器组件
- **响应式**：基于 Ant Design 的栅格系统（Row、Col）实现响应式布局

## 6. 网络层开发规范

### 6.1 接口服务定义 (src/services/)
- **强制规范**：API 接口必须严格遵循如下规范：
```typescript
import request from '@/utils/request';

// 接口响应类型定义
interface DataResponse {
  id: string /** 数据ID */;
  name: string /** 名称 */;
  status: number /** 状态 */;
}

// API 函数定义
export const yourPageApi = {
  /**
   * 获取数据列表
   * @param params 查询参数
   */
  getData(params?: { pageNum?: number; pageSize?: number }) {
    return request<DataResponse[]>({
      url: '/api/data/list',
      method: 'GET',
      params: {
        pageNum: 1,
        pageSize: 10,
        ...params,
      },
    });
  },

  /**
   * 创建数据
   * @param data 创建数据
   */
  createData(data: Partial<DataResponse>) {
    return request<DataResponse>({
      url: '/api/data/create',
      method: 'POST',
      data,
    });
  },

  /**
   * 更新数据
   * @param id 数据ID
   * @param data 更新数据
   */
  updateData(id: string, data: Partial<DataResponse>) {
    return request<DataResponse>({
      url: `/api/data/${id}`,
      method: 'PUT',
      data,
    });
  },

  /**
   * 删除数据
   * @param id 数据ID
   */
  deleteData(id: string) {
    return request<void>({
      url: `/api/data/${id}`,
      method: 'DELETE',
    });
  },
};
```

### 6.2 网络请求规范
- **强制**：必须使用项目封装的 request 工具（位于 `utils/request.ts`）
- **强制**：API 函数必须包含清晰的 JSDoc 注释说明参数和返回值
- **强制**：请求方法使用大写（GET/POST/PUT/DELETE）
- **强制**：所有接口必须定义 TypeScript 类型
- **推荐**：接口服务按业务模块分组，如 `user.ts`、`base.ts`
- **强制**：错误处理统一在 request 工具中处理，页面层面处理具体业务逻辑

## 7. 状态管理规范 (Zustand - 预留)

### 7.1 Store 定义（预留）
```typescript
// src/stores/globalStore.ts
import { create } from 'zustand';
import { devtools } from 'zustand/middleware';
import { immer } from 'zustand/middleware/immer';

export interface UserInfo {
  id?: string;
  name?: string;
  email?: string;
  permissions: string[];
}

export interface GlobalState {
  userInfo?: UserInfo;
  theme: 'light' | 'dark';
  loading: boolean;
  setUserInfo: (userInfo: UserInfo) => void;
  setTheme: (theme: 'light' | 'dark') => void;
  setLoading: (loading: boolean) => void;
}

const useGlobalStore = create<GlobalState>()(
  devtools(
    immer((set) => ({
      theme: 'light',
      loading: false,
      userInfo: {
        permissions: [],
      },

      setUserInfo: (userInfo) => {
        set((state) => {
          state.userInfo = userInfo;
        });
      },

      setTheme: (theme) => {
        set((state) => {
          state.theme = theme;
        });
      },

      setLoading: (loading) => {
        set((state) => {
          state.loading = loading;
        });
      },
    })),
  ),
);

export default useGlobalStore;
```

### 7.2 组件中使用 Zustand（预留）
```typescript
import useGlobalStore from '@/stores/globalStore';

const YourComponent: React.FC = () => {
  // 获取状态和方法
  const { userInfo, theme, setTheme, setUserInfo } = useGlobalStore();

  // 选择性订阅（性能优化）
  const userInfo = useGlobalStore((state) => state.userInfo);
  const setUserInfo = useGlobalStore((state) => state.setUserInfo);

  const handleLogout = () => {
    setUserInfo({ permissions: [] });
  };

  return (
    <div>
      <p>用户：{userInfo?.name}</p>
      <Button onClick={handleLogout}>退出登录</Button>
    </div>
  );
};
```

### 7.3 状态管理要求
- **推荐**：优先使用组件内部 useState 管理状态，只有需要跨组件共享的状态才使用 Zustand
- **强制**：Store 必须定义完整的 TypeScript 类型
- **推荐**：使用 devtools 和 immer 中间件进行状态管理和调试
- **推荐**：使用选择性订阅优化性能，避免不必要的重新渲染

## 8. 工程化操作

### 8.1 项目开发
#### 8.1.1 安装依赖
```bash
npm install
```

#### 8.1.2 项目启动
本地开发命令：
```bash
# 开发环境
npm run dev
```

#### 8.1.3 项目构建
```bash
# 构建生产版本（使用Vite）
npm run build
```

### 8.2 开发工具配置
- **路径别名**：项目已配置路径映射，可以使用 `@/` 指向 `src/` 目录
- **热重载**：开发环境支持 Vite HMR，代码修改后自动刷新
- **构建优化**：使用 Vite 构建工具，支持按需加载、代码分割、压缩等优化策略
- **TypeScript**：严格模式，确保类型安全
- **ESLint & Prettier**：代码质量检查和格式化

### 8.3 代码提交规范
```bash
# 提交前会自动运行 lint-staged 检查
git add .
git commit -m "feat: 新增功能描述"

# 提交信息格式建议遵循 conventional commits 规范
# feat: 新功能
# fix: 问题修复 
# docs: 文档更新
# style: 代码格式调整
# refactor: 代码重构
# test: 测试相关
# chore: 构建工具或辅助工具的变动
```

### 8.4 分支管理
```bash
# 从主分支创建功能分支
git checkout -b feature/your-feature-name

# 开发完成后合并到测试分支
git checkout develop
git pull origin develop
git merge feature/your-feature-name

# 测试通过后合并到主分支 
git checkout main
git pull origin main
git merge develop
```
> **注意**：当遇到代码合并冲突时，请与团队确认合并策略，切勿强制覆盖！

## 9. 重要技术要点

### 9.1 TanStack Router 配置
```typescript
// src/main.tsx
import { createRouter, RouterProvider } from '@tanstack/react-router';
import { routeTree } from './routeTree.gen';

const router = createRouter({ routeTree });

// 在 React 应用中使用
<RouterProvider router={router} />
```

### 9.2 Ant Design 配置
```typescript
// src/components/AntdProvider.tsx
import { ConfigProvider } from 'antd';
import zhCN from 'antd/locale/zh_CN';

export function AntdProvider({ children }: { children: React.ReactNode }) {
  return (
    <ConfigProvider locale={zhCN}>
      {children}
    </ConfigProvider>
  );
}
```

### 9.3 路径别名配置
```typescript
// vite.config.ts
resolve: {
  alias: {
    '@': path.resolve(__dirname, './src'),
  },
}

// tsconfig.json
{
  "compilerOptions": {
    "baseUrl": ".",
    "paths": {
      "@/*": ["src/*"]
    }
  }
}
```

### 9.4 图标映射系统
```typescript
// src/utils/iconMap.tsx
import React from 'react';
import {
  DashboardOutlined,
  BulbOutlined,
  TeamOutlined,
  DatabaseOutlined,
  BarChartOutlined,
  ToolOutlined,
} from '@ant-design/icons';

export const iconMap: Record<string, React.ReactNode> = {
  DashboardOutlined: <DashboardOutlined />,
  BulbOutlined: <BulbOutlined />,
  TeamOutlined: <TeamOutlined />,
  DatabaseOutlined: <DatabaseOutlined />,
  BarChartOutlined: <BarChartOutlined />,
  ToolOutlined: <ToolOutlined />,
};

export const getIcon = (iconName?: string): React.ReactNode => {
  if (!iconName) return null;
  return iconMap[iconName] || null;
};
```

### 9.5 应用初始化
```typescript
// src/main.tsx
import React from 'react';
import ReactDOM from 'react-dom/client';
import { createRouter, RouterProvider } from '@tanstack/react-router';
import { routeTree } from './routeTree.gen';
import { AntdProvider } from './components/AntdProvider';
import './index.css';

const router = createRouter({ routeTree });

ReactDOM.createRoot(document.getElementById('root')!).render(
  <React.StrictMode>
    <AntdProvider>
      <RouterProvider router={router} />
    </AntdProvider>
  </React.StrictMode>,
);
```
